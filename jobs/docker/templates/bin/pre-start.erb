#!/bin/bash

set -ex

mkdir -p /etc/security/limits.d

cat << EOF > /etc/security/limits.d/62-ulimit.conf
# Do not edit this file; it will be overwritten.
# Created by the pre-start script of the BOSH job "docker"
* soft nofile 65535
* hard nofile 65535
EOF

monit_pid=$( ps -e | grep monit | awk '{print $1}' )

if [ ! -z "$monit_pid" ]; then
  prlimit --pid $monit_pid --nofile=65535:65535
fi