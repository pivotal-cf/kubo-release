#!/bin/bash
set -e -x

source /var/vcap/packages/golang-1.12-linux/bosh/compile.env

mkdir $GOPATH/src
cp -r osl-collector $GOPATH/src
cd $GOPATH/src/osl-collector

go test ./...
go build

cp -a osl-collector ${BOSH_INSTALL_TARGET}/
${BOSH_INSTALL_TARGET}/osl-collector -folder /var/vcap/packages -output ${BOSH_INSTALL_TARGET}/osl-output.json

# TODO: figure out flags
# go test -c -v -o  ${BOSH_INSTALL_TARGET}/run-smoke-tests
# cp -a fixtures $BOSH_INSTALL_TARGET
