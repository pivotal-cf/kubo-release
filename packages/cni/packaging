set -exu

mkdir -p ${BOSH_INSTALL_TARGET}/bin
tar -xzf cni/cni-plugins-amd64*.tgz -C ${BOSH_INSTALL_TARGET}/bin/

# sadly, the binaries just copied do NOT have the release's version number burned in to them,
# so we must extract version from the tarball just expanded and pass that along via a text file
REGEX='.*cni-plugins-amd64-([a-zA-Z\.0-9]+)\.tgz.*'
[[ "$(ls cni/cni-plugins-amd64*.tgz)" =~ $REGEX ]]
CNI_RELEASE_VERSION=${BASH_REMATCH[1]}
echo $CNI_RELEASE_VERSION > ${BOSH_INSTALL_TARGET}/bin/BOSHCYCLE_CNI_RELEASE_VERSION

mkdir -p utillocal
dpkg -x cni/util-linux*.deb utillocal/

cp utillocal/usr/bin/nsenter ${BOSH_INSTALL_TARGET}/bin

chmod +x ${BOSH_INSTALL_TARGET}/bin/*
